# Bezrook - Система аутентификации с TOTP

Полнофункциональная система аутентификации с поддержкой двухфакторной аутентификации через TOTP (Google Authenticator).

## Структура проекта

- `frontend/` - React приложение (Vite)
- `backend/` - FastAPI бэкенд

## Быстрый старт

### 1. Генерация секретов

Сгенерируйте секреты любым безопасным способом, например:
```bash
openssl rand -base64 32 > secrets/db_password.txt
openssl rand -base64 64 > secrets/jwt_key.txt
```

### 2. Запуск 
Запустите контейнеры
```bash
docker compose up --build
```


## Функциональность

### Регистрация
- Валидация пароля (минимум 10 символов, заглавные/строчные буквы, цифры, спецсимволы)
- Проверка совпадения паролей
- Хеширование паролей с помощью bcrypt

### Вход
- Аутентификация по логину и паролю
- JWT токены для сессий
- Автоматическое перенаправление на TOTP, если включена 2FA

### TOTP (Google Authenticator)
- Генерация секретного ключа
- QR-код для сканирования в Google Authenticator
- Верификация 6-значных кодов
- Поддержка вставки кода из буфера обмена

### Личный кабинет
- Просмотр информации о пользователе
- Управление сессиями
- Настройка TOTP 2FA

## API Endpoints

- `POST /api/register` - Регистрация пользователя
- `POST /api/login` - Вход в систему
- `GET /api/user` - Получить данные текущего пользователя (требует авторизации)
- `POST /api/totp/setup` - Настроить TOTP (требует авторизации)
- `POST /api/totp/verify` - Проверить TOTP код (требует авторизации)
- `GET /api/sessions` - Получить список сессий (требует авторизации)
- `DELETE /api/sessions/{session_id}` - Завершить сессию (требует авторизации)

## Технологии

### Frontend
- React 18
- React Router
- Vite
- Axios

### Backend
- FastAPI
- SQLAlchemy (ORM)
- PostgreSQL
- PyJWT (JWT токены)
- Passlib (хеширование паролей)
- PyOTP (TOTP)
- QRCode (генерация QR-кодов)

## Безопасность. Что сделано

- Пароли хешируются с использованием bcrypt  
- JWT-токены имеют ограниченный срок действия
- Реализовано управление сессиями: просмотр, удаление, идентификация текущей сессии  
- Ведётся аудит: логируются успешные и неуспешные попытки аутентификации  
- Поддержка TOTP: привязка секрета к пользователю, верификация кодов  
- TOTP-коды действительны 30 секунд
- Приложение контейнеризовано с использованием Docker и docker-compose  
- Конфиденциальные параметры передаются через Docker Secrets  
- CORS настроен с явным указанием allow_origins, без wildcard  
- Реализована сетевая изоляция: создана внутренняя сеть для backend, порт СУБД не экспонируется наружу