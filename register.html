<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/login.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <title>Sign Up</title>
</head>
<body>
        <div class="error-container">
            <span class="ttl"></span>
            <p class="error-message">
                Ошибка
            </p>
            <button class="close-btn" aria-label="Закрыть"></button>
        </div>
        <div class="login-container">
            <h1 class="logo">bezrook</h1>
                
            <form class="login-form" action="#" method="POST">
                <h2 class="form-header">Sign Up</h2>

                <div class="form-group">
                    <label class="form-label" for="email">Login</label>
                    <input  class="form-input" type="text" id="login" name="login" placeholder="username" required>
                </div>

                <div class="form-group">
                    <label class="form-label" for="password">Password</label>
                    <div class="password-input-1">
                        <input class="form-input form-input-m0" type="password" id="password" name="password" placeholder="password" required>
                        <span class="toggle-password" id="togglePassword1"></span> 
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="password">Password</label>
                    <div class="password-input">
                        <input class="form-input form-input-m0" type="password" id="passwordRep" name="password-rep" placeholder="password" required>
                        <span class="toggle-password" id="togglePassword2"></span> 
                    </div>
                </div>

                <button type="submit" class="sign-in-btn">Sign Up</button>

                <div class="signup-text">
                    Already have an account? <a class="signup-link" href="#">Login</a>
                </div>
            </form>
        </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const form = document.querySelector('.login-form');
    const loginInput = document.getElementById('login');
    const passwordInput = document.getElementById('password');
    const passwordRepInput = document.getElementById('passwordRep');
    const errorContainer = document.querySelector('.error-container');
    const errorMessage = errorContainer.querySelector('.error-message');
    const ttlBar = errorContainer.querySelector('.ttl');
    const closeBtn = errorContainer.querySelector('.close-btn');

    // Флаг: показывать ли ошибки сразу после отправки
    let showErrorImmediately = false;

    // Функция показа ошибки
    function showError(message, duration = 5000) {
        errorContainer.style.display = 'block';
        errorMessage.textContent = message;
        errorContainer.classList.add('show');

        // Устанавливаем длительность через CSS-переменную
        ttlBar.style.setProperty('--duration', `${duration / 1000}s`);

        // Перезапускаем анимацию TTL: убираем и снова добавляем класс
        ttlBar.classList.remove('running');
        // Небольшая задержка для перерисовки
        setTimeout(() => {
            ttlBar.classList.add('running');
        }, 10);

        // Скрываем уведомление через duration
        setTimeout(() => {
        errorContainer.classList.remove('show');
        }, duration);
    }

    // Закрытие по крестику
    closeBtn.addEventListener('click', () => {
        errorContainer.style.display = 'none';
    });

    // Проверка надёжности пароля
    function validatePassword(pwd) {
        if (pwd.length < 10) return "Пароль должен содержать не менее 10 символов.";
        if (!/[a-z]/.test(pwd)) return "Пароль должен содержать хотя бы одну строчную букву.";
        if (!/[A-Z]/.test(pwd)) return "Пароль должен содержать хотя бы одну заглавную букву.";
        if (!/\d/.test(pwd)) return "Пароль должен содержать хотя бы одну цифру.";
        if (!/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(pwd)) 
            return "Пароль должен содержать хотя бы один спецсимвол (!@#$%^&* и др.).";
        return null; // всё ок
    }

    // Скрыть ошибку при исправлении
    [loginInput, passwordInput, passwordRepInput].forEach(input => {
        input.addEventListener('input', () => {
            if (errorContainer.style.display === 'block') {
                errorContainer.style.display = 'none';
            }
        });
    });

    // Toggle password visibility
    document.getElementById('togglePassword1')?.addEventListener('click', () => {
        passwordInput.type = passwordInput.type === 'password' ? 'text' : 'password';
    });
    document.getElementById('togglePassword2')?.addEventListener('click', () => {
        passwordRepInput.type = passwordRepInput.type === 'password' ? 'text' : 'password';
    });

    // Отправка формы
    form.addEventListener('submit', (e) => {
        e.preventDefault(); // останавливаем отправку

        let error = null;

        // 1. Проверка пароля
        const pwdError = validatePassword(passwordInput.value);
        if (pwdError) {
            error = pwdError;
        }
        // 2. Проверка совпадения
        else if (passwordInput.value !== passwordRepInput.value) {
            error = "Пароли не совпадают.";
        }

        if (error) {
            showError(error);
        } else {
            // ✅ Всё валидно — можно отправлять на сервер
            alert("Регистрация успешна!"); // замените на fetch(...)
            // form.submit(); // если нужно
        }
    });
});
</script>
</body>
</html>